<!DOCTYPE html>
<html>  
    <head>  
        <meta charset="utf-8">  
        <title>D3.js Practice</title>  
        <link href="d3pra.css", rel="stylesheet", type="text/css">
    </head>  
    <body>  
		
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>  
        <script>
        
        
        var width = 500;	//画布的宽度
	    var height = 200;	//画布的高度

	    var rectsvg = d3.select("body")				//选择文档中的body元素
				.append("svg")				//添加一个svg元素
				.attr("width", width)		//设定宽度
				.attr("height", height);	//设定高度
	
	    var dataset = [ 80 , 90, 70 , 60 , 70 ];
        var skills = ["SQL", "Python", "SAS", "R", "JavaScript"];
        

	    var linear = d3.scale.linear()
					.domain([0, d3.max(dataset)])
					.range([0, 250]);

        var axis = d3.svg.axis()
                     .scale(linear)
                     .orient("bottom")
                     .ticks(8);    

	    var rectHeight = 25;	//每个矩形所占的像素高度(包括空白)
        var yposition = 25 * dataset.length;
        

	    var rects = rectsvg.selectAll("rect")
		  .data(dataset)
		  .enter()
		  .append("rect")
		  .attr("x",170)
		  .attr("y",function(d,i){
				return i * rectHeight;
		  })
		  .attr("width",function(d){
		   		return linear(d);
		  })
		  .attr("height",rectHeight-2)
		  .attr("fill","steelblue")
          .on("mouseover", function(d,i){
              d3.select(this)
                .attr("fill","black");
          })
          .on("mouseout", function(d,i){
              d3.select(this)
                .attr("fill","steelblue");
          }); 
          /*
          .transition()
          .duration(2000)
          .delay(1000)
          .ease("bounce")
          .attr("x", 220)
          .style("fill","darkgrey");*/

          
        /*
        svg.append("g")
           .attr("class","axis")
           .attr("transform", "translate(170,"+ yposition + ")")
           .call(axis);  */

        var texts = rectsvg.selectAll(".MyText")
                       .data(skills)
                       .enter()
                       .append("text")
                       .attr("class", "MyText")
                       .attr("transform", "translate(20, 15)")
                       .attr("x", function(){
                           return 70;
                       })
                       .attr("y", function(d,i){
                           return i * rectHeight;
                       })
                       .text(function(d){
                           return d;
                       })
                       .transition()
                       .delay(1000)
                       .attr("x", 120)
                       .transition()
                       .duration(2000)
                       .attr("x", 70);
         

        //Pie Chart
        var piewidth = 400;
		var pieheight = 400;
		var pieDataset = [{label:"A", count: 30}, {label:"B", count: 10}, {label:"C", count: 43}, {label:"D", count:55}, {label:"E", count:13}];
		var getNum = function(){
            var pie_data = [];
            for (var i=0; i < pieDataset.length; i++){
                pie_data.push(pieDataset[i].count);
            };
            return pie_data;
        };
        //console.log(pieDataset.length);
        var pie_data = getNum();
        //console.log(pie_data);
		var piesvg = d3.select("body")
					.append("svg")
					.attr("width", piewidth)
					.attr("height", pieheight);
		
		var pie = d3.layout.pie();

		var piedata = pie(pie_data);
		
		var outerRadius = 150;	//外半径
		var innerRadius = 70;	//内半径，为0则中间没有空白

		var arc = d3.svg.arc()	//弧生成器
					.innerRadius(innerRadius)	//设置内半径
					.outerRadius(outerRadius);	//设置外半径
		
		var color = d3.scale.category20();
		
		var arcs = piesvg.selectAll("g")
					  .data(piedata)
					  .enter()
					  .append("g")
					  .attr("transform","translate("+ (piewidth/2) +","+ (piewidth/2) +")");
					  
		arcs.append("path")
			.attr("fill",function(d,i){
				return color(i);
			})
			.attr("d",function(d){
				return arc(d);
			});
		
		arcs.append("text")
			.attr("transform",function(d){
				return "translate(" + arc.centroid(d) + ")";
			})
			.attr("text-anchor","middle")
			.text(function(d){
				return d.data;
			});
		
		console.log(dataset);
		console.log(piedata);
        
        //Force-directed graph
        var fdWidth = 500;
        var fdHeight = 500;

        var fdsvg = d3.select("body")
                      .append("svg")
                      .attr("width", fdWidth)
                      .attr("height", fdHeight);

        var nodes = [ { name: "桂林" }, { name: "广州" },
                      { name: "厦门" }, { name: "杭州" },
                      { name: "上海" }, { name: "青岛" },
                      { name: "天津" } ];
 
        var edges = [ { source : 0 , target: 1 } , { source : 0 , target: 2 } ,
                      { source : 0 , target: 3 } , { source : 1 , target: 4 } ,
                      { source : 1 , target: 5 } , { source : 1 , target: 6 } ];

        var force = d3.layout.force()
                      .nodes(nodes)
                      .links(edges)
                      .size([fdWidth,fdHeight])
                      .linkDistance(150)
                      .charge([-300]);

        force.start();

        console.log(nodes);
        console.log(edges);

        var svg_edges = fdsvg.selectAll("line")
                             .data(edges)
                             .enter()
                             .append("line")
                             .style("stroke","black")
                             .style("stroke-width",1);

        

        var svg_nodes = fdsvg.selectAll("circle")
                             .data(nodes)
                             .enter()
                             .append("circle")
                             .attr("r", 20)
                             .style("fill",function(d,i){
                                 return color(i);
                             })
                             .call(force.drag);

        var svg_texts = fdsvg.selectAll("text")
                           .data(nodes)
                           .enter()
                           .append("text")
                           .style("fill","black")
                           .attr("dx",20)
                           .attr("dy",8)
                           .text(function(d){
                               return d.name;
                           });

        force.on("tick", function(){
            svg_edges.attr("x1",function(d){return d.source.x;})
                     .attr("y1",function(d){return d.source.y;})
                     .attr("x2",function(d){return d.target.x;})
                     .attr("y2",function(d){return d.target.y;});

            svg_nodes.attr("cx", function(d){return d.x;})
                     .attr("cy", function(d){return d.y;});

            svg_texts.attr("x", function(d){return d.x;})
                     .attr("y", function(d){return d.y;});
        });

            


        </script>  
  
    </body>  
</html>  